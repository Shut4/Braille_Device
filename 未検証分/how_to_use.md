3PC構成によるリアルタイム点字変換システムの動作検証手順について

この検証では、**ネットワーク通信**と**各PCの内部処理**を分離し、データがPC1からPC3のESP32まで滞りなく流れることを段階的に確認するものである


---

## 準備: 環境設定と起動順序

検証を開始する前に、すべてのPCで設定値を確認し、以下の順序でプログラムを起動してください。

### 1. 接続設定の確認

| 項目 | PC1 (`pc1_camera_sender.py`) | PC2 (`img_Net_Server.pde` / `pc2_ocr_converter.py`) | PC3 (`tennji_serverBa.pde`) |
| :--- | :--- | :--- | :--- |
| **PC2 IP/Port** | PC2のIP / `5554` | Server Port: `5554` (画像受信) | - |
| **PC3 IP/Port** | - | PC3のIP / `12345` | Server Port: `12345` (バイナリ受信) |
| **シリアル設定** | - | - | Port: `COM5` (修正推奨), Baud: `115200` (ESP32と一致) |
| **ファイルパス** | - | `TEMP_IMAGE_PATH` (`temp_image.jpg`の保存先), `PYTHON_SCRIPT_PATH` | - |

### 2. プログラムの起動順序

必ず**サーバー側**から起動し、接続を待ち受けさせてください。

1.  **PC3**: **`tennji_serverBa.pde`** を起動（ポート12345で待ち受け開始）
2.  **PC2**: **`pc2_ocr_converter.py`** を起動（画像ファイル生成をポーリング開始）
3.  **PC2**: **`img_Net_Server.pde`** を起動（ポート5554で待ち受け開始）
4.  **PC1**: **`pc1_camera_sender.py`** を起動（画像送信開始）

---

## 🔬 フェーズ 1: 画像通信の検証 (PC1 → PC2)

PC1のカメラ画像がPC2のProcessingコードに正常に転送され、Pythonが処理できるファイル形式で保存されるかを確認します。

| No. | 実行項目 | 期待される動作 (コンソール/画面) | 成功判定 |
| :--- | :--- | :--- | :--- |
| **1-1** | PC1 (`pc1_camera_sender.py`) 実行 | `✅ ヘッダー送信完了: H=..., W=...` が表示されること。 | PC1送信成功 |
| **1-2** | PC2 (`img_Net_Server.pde`) 画面 | **状態 1** に遷移し、`高さ=..., 幅=...` が表示されること。その後、`=> 受信完了` が表示されること。 | PC2画像受信成功 |
| **1-3** | PC2 ファイルシステム | プロジェクトルートに **`temp_image.jpg`** ファイルが生成されていること。 | 画像ファイル保存成功 |

---

## 🔬 フェーズ 2: OCR/点字変換の検証 (PC2 内部処理)

PC2で画像ファイル生成がトリガーとなり、Pythonスクリプトが起動し、正しい点字バイナリ信号を生成するかを確認します。

| No. | 実行項目 | 期待される動作 (PC2 Pythonコンソール) | 成功判定 |
| :--- | :--- | :--- | :--- |
| **2-1** | `temp_image.jpg` 生成 (1-3の後) | `DEBUG: Correct Project root added to path: ...`が表示されること。 | Pythonパス設定成功 |
| **2-2** | OCR処理 | **`✅ OCR結果 (元のテキスト): ...`** が表示されること。 | OCR処理成功 |
| **2-3** | 点訳前処理 | **`📄 点訳前処理テキスト: ...`** が表示され、分かち書きや「は」→「わ」の修正が適用されていること。 | 点訳前処理成功 |
| **2-4** | ファイル削除 | **`🗑️ 画像ファイル ... を削除しました。`** が表示されること。 | トリガーリセット成功 |

---

## 🔬 フェーズ 3: バイナリ通信の検証 (PC2 → PC3)

生成されたバイナリ文字列がネットワーク経由でPC3に届くかを確認します。

| No. | 実行項目 | 期待される動作 (コンソール/画面) | 成功判定 |
| :--- | :--- | :--- | :--- |
| **3-1** | PC2 (`pc2_ocr_converter.py`) 実行 | Pythonコンソールで **`✅ バイナリ送信完了: ... の信号を PC3 ... に送信しました。`** が表示されること。 | PC2送信成功 |
| **3-2** | PC3 (`tennji_serverBa.pde`) の画面 | **`✅ Received & Sent: ...`** というメッセージが表示され、受信したバイナリ文字列（例: `100000110000...`）の一部が表示されること。 | PC3ネットワーク受信成功 |

---

## 🔬 フェーズ 4: シリアル通信と最終出力の検証 (PC3 → ESP32)

PC3が受信したバイナリ文字列をシリアルポート経由でESP32に転送し、点字ピンが駆動することを確認します。

| No. | 実行項目 | 期待される動作 (PC3/物理デバイス) | 成功判定 |
| :--- | :--- | :--- | :--- |
| **4-1** | PC3 (`tennji_serverBa.pde`) の起動 | シリアルポート接続時に **`Server: Port COM5 Ready.`** など、シリアル接続成功のメッセージが表示されていること。 | シリアル初期化成功 |
| **4-2** | PC3 (`tennji_serverBa.pde`) 実行 | 受信したバイナリ文字列が **`controlPort.write()`** でシリアルポートに転送され、**ESP32側のシリアル受信LEDが点滅**すること。 | シリアル転送成功 |
| **4-3** | 物理デバイス動作 | **点字ピンが駆動し、OCRで読み取られた文字に対応する点字パターンを表示**すること。 | 最終動作成功 |

---

## 🏁 最終検証: エンドツーエンドのリアルタイム動作

すべてのフェーズが単独で成功した後、PC1のカメラの前に文字をかざし、システム全体の連携と安定性を確認します。

1.  **動作確認**: PC1のカメラの前に「あいうえお」や「東京へ行きます」など、異なるテキストを提示します。
2.  **連続性**: 設定された `CAP_INTERVAL` (例: 2秒) ごとに、一連の流れが繰り返し実行され、点字ピンの表示が連続的に更新されることを確認します。
3.  **安定性の確認**: システムを長時間稼働させ、ネットワーク接続の切断やメモリリークによるクラッシュが発生しないことを監視します。